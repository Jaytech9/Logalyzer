<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Log Analysis Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .upload-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }

        .upload-area {
            border: 3px dashed rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
        }

        .upload-area:hover {
            border-color: white;
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #fff;
            background: rgba(255, 255, 255, 0.3);
        }

        .upload-icon {
            font-size: 3em;
            color: white;
            margin-bottom: 15px;
        }

        .upload-text {
            color: white;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 15px 10px;
            font-weight: 600;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .query-section {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }

        .query-section h3 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        .query-section p {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .query-box {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        #queryInput {
            flex-grow: 1;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 25px;
            font-size: 1em;
            outline: none;
            transition: border-color 0.3s ease;
        }

        #queryInput:focus {
            border-color: #667eea;
        }

        .query-results-box {
            margin-top: 20px;
            text-align: left;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
            animation: fadeIn 0.5s ease;
        }

        .results-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .analysis-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
        }

        .analysis-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 600;
        }

        .error-item, .warning-item, .pattern-item, .item-content {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .error-item, .warning-item, .pattern-item {
            background: #f8f9fa;
        }

        .error-item {
            border-left-color: #e74c3c;
            background: #fdf2f2;
        }

        .warning-item {
            border-left-color: #f39c12;
            background: #fef9e7;
        }

        .pattern-item {
            border-left-color: #3498db;
            background: #f0f8ff;
        }

        .item-content {
            flex: 1;
            padding: 0;
            background: transparent;
            border: none;
            display: block; /* Override flex for the list */
        }
        
        .item-content + .item-count {
            margin-left: 15px;
        }

        .item-message {
            font-weight: 500;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .item-details {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .item-count {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }

        .trends-section {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            color: #2c3e50;
        }

        .trends-section h3 {
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .trend-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .export-section {
            text-align: center;
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
        }

        .export-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            margin: 0 10px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .no-data {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 20px;
        }

        .severity-high { border-left-color: #e74c3c !important; }
        .severity-medium { border-left-color: #f39c12 !important; }
        .severity-low { border-left-color: #27ae60 !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Advanced Log Analysis Tool</h1>
            <p>Streamline your log analysis with intelligent pattern detection and comprehensive reporting</p>
        </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text">
                    <strong>Drop your log files here or click to browse</strong><br>
                    Supports .log, .txt, .csv files and more
                </div>
                <input type="file" id="fileInput" class="file-input" multiple accept=".log,.txt,.csv">
            </div>
            <button id="analyzeBtn" class="analyze-btn" disabled>üöÄ Analyze Logs</button>
            <button id="clearBtn" class="analyze-btn">üóëÔ∏è Clear All</button>
        </div>

        <div class="query-section">
            <h3>üó£Ô∏è Ask a Question</h3>
            <p>Get specific answers from your log data using natural language</p>
            <div class="query-box">
                <input type="text" id="queryInput" placeholder="e.g., Show me all errors related to 'Database Connection'.">
                <button id="queryBtn" class="analyze-btn">Ask</button>
            </div>
            <div id="query-results" class="query-results-box">
                <p class="no-data">Your answers will appear here...</p>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing your logs... This may take a moment for large files.</p>
        </div>

        <div class="results-section" id="results">
            <div class="stats-grid" id="statsGrid">
                </div>

            <div class="analysis-grid">
                <div class="analysis-card">
                    <h3>üö® Critical Errors</h3>
                    <div id="errorsList">
                        <div class="no-data">No critical errors found</div>
                    </div>
                </div>

                <div class="analysis-card">
                    <h3>‚ö†Ô∏è Warnings</h3>
                    <div id="warningsList">
                        <div class="no-data">No warnings found</div>
                    </div>
                </div>

                <div class="analysis-card">
                    <h3>üîÑ Recurring Issues</h3>
                    <div id="recurringList">
                        <div class="no-data">No recurring issues detected</div>
                    </div>
                </div>

                <div class="analysis-card">
                    <h3>üìä Pattern Analysis</h3>
                    <div id="patternsList">
                        <div class="no-data">No significant patterns detected</div>
                    </div>
                </div>
            </div>

            <div class="trends-section">
                <h3>üìà Trends & Insights</h3>
                <div id="trendsContent">
                    <div class="no-data">Upload and analyze logs to see trends</div>
                </div>
            </div>

            <div class="export-section">
                <h3>üìã Export Results</h3>
                <p>Save your analysis results in different formats</p>
                <button class="export-btn" onclick="exportJSON()">üìÑ Export JSON</button>
                <button class="export-btn" onclick="exportCSV()">üìä Export CSV</button>
                <button class="export-btn" onclick="exportReport()">üìã Export Report</button>
            </div>
        </div>
    </div>

    <script>
        let analysisData = {};
        let logFiles = [];

        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultsSection = document.getElementById('results');
        const loadingSection = document.getElementById('loading');
        const queryInput = document.getElementById('queryInput');
        const queryBtn = document.getElementById('queryBtn');
        const queryResultsDiv = document.getElementById('query-results');

        // File upload handling
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            logFiles = Array.from(files);
            if (logFiles.length > 0) {
                analyzeBtn.disabled = false;
                uploadArea.querySelector('.upload-text').innerHTML = 
                    `<strong>${logFiles.length} file(s) selected</strong><br>Ready to analyze`;
            }
        }

        // Main analysis function
        analyzeBtn.addEventListener('click', async () => {
            if (logFiles.length === 0) return;

            showLoading(true);
            analysisData = {
                totalLines: 0,
                errors: {},
                warnings: {},
                patterns: {},
                timestamps: [],
                files: logFiles.length,
                uniqueErrors: new Set(),
                uniqueWarnings: new Set()
            };

            for (const file of logFiles) {
                await analyzeFile(file);
            }

            generateAnalysis();
            showResults();
            showLoading(false);
        });

        async function analyzeFile(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const content = e.target.result;
                    const lines = content.split('\n');
                    
                    analysisData.totalLines += lines.length;
                    
                    lines.forEach((line, index) => {
                        if (line.trim()) {
                            analyzeLine(line, file.name, index + 1);
                        }
                    });
                    
                    resolve();
                };
                reader.readAsText(file);
            });
        }

        function analyzeLine(line, fileName, lineNumber) {
            const timestamp = extractTimestamp(line);
            if (timestamp) {
                analysisData.timestamps.push(timestamp);
            }

            const errorPatterns = [
                /error/i, /exception/i, /failed/i, /failure/i, /fatal/i,
                /critical/i, /severe/i, /panic/i, /crash/i, /abort/i
            ];

            const warningPatterns = [
                /warn/i, /warning/i, /caution/i, /deprecated/i, /timeout/i,
                /retry/i, /slow/i, /performance/i
            ];

            for (const pattern of errorPatterns) {
                if (pattern.test(line)) {
                    const errorKey = extractErrorMessage(line);
                    if (!analysisData.errors[errorKey]) {
                        analysisData.errors[errorKey] = {
                            count: 0,
                            files: new Set(),
                            lines: [],
                            severity: determineSeverity(line)
                        };
                    }
                    analysisData.errors[errorKey].count++;
                    analysisData.errors[errorKey].files.add(fileName);
                    analysisData.errors[errorKey].lines.push(lineNumber);
                    analysisData.uniqueErrors.add(errorKey);
                    break;
                }
            }

            for (const pattern of warningPatterns) {
                if (pattern.test(line)) {
                    const warningKey = extractWarningMessage(line);
                    if (!analysisData.warnings[warningKey]) {
                        analysisData.warnings[warningKey] = {
                            count: 0,
                            files: new Set(),
                            lines: []
                        };
                    }
                    analysisData.warnings[warningKey].count++;
                    analysisData.warnings[warningKey].files.add(fileName);
                    analysisData.warnings[warningKey].lines.push(lineNumber);
                    analysisData.uniqueWarnings.add(warningKey);
                    break;
                }
            }

            detectPatterns(line);
        }

        function extractTimestamp(line) {
            const patterns = [
                /\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}/,
                /\d{2}\/\d{2}\/\d{4}\s\d{2}:\d{2}:\d{2}/,
                /\w{3}\s\d{2}\s\d{2}:\d{2}:\d{2}/
            ];
            
            for (const pattern of patterns) {
                const match = line.match(pattern);
                if (match) return new Date(match[0]);
            }
            return null;
        }

        function extractErrorMessage(line) {
            const cleaned = line.replace(/^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}/, '')
                               .replace(/\[.*?\]/g, '')
                               .trim();
            return cleaned.substring(0, 100) + (cleaned.length > 100 ? '...' : '');
        }

        function extractWarningMessage(line) {
            const cleaned = line.replace(/^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}/, '')
                               .replace(/\[.*?\]/g, '')
                               .trim();
            return cleaned.substring(0, 100) + (cleaned.length > 100 ? '...' : '');
        }

        function determineSeverity(line) {
            if (/fatal|critical|severe|panic|crash/i.test(line)) return 'high';
            if (/error|exception|failed|failure/i.test(line)) return 'medium';
            return 'low';
        }

        function detectPatterns(line) {
            const ipPattern = /\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b/g;
            const ips = line.match(ipPattern);
            if (ips) {
                ips.forEach(ip => {
                    if (!analysisData.patterns[`IP: ${ip}`]) {
                        analysisData.patterns[`IP: ${ip}`] = { count: 0, type: 'ip' };
                    }
                    analysisData.patterns[`IP: ${ip}`].count++;
                });
            }

            const httpPattern = /\b[1-5]\d{2}\b/g;
            const codes = line.match(httpPattern);
            if (codes) {
                codes.forEach(code => {
                    if (parseInt(code) >= 100 && parseInt(code) <= 599) {
                        if (!analysisData.patterns[`HTTP ${code}`]) {
                            analysisData.patterns[`HTTP ${code}`] = { count: 0, type: 'http' };
                        }
                        analysisData.patterns[`HTTP ${code}`].count++;
                    }
                });
            }

            if (/database|sql|mysql|postgres|oracle/i.test(line)) {
                if (!analysisData.patterns['Database Operations']) {
                    analysisData.patterns['Database Operations'] = { count: 0, type: 'database' };
                }
                analysisData.patterns['Database Operations'].count++;
            }
        }

        function generateAnalysis() {
            const totalErrors = Object.values(analysisData.errors).reduce((sum, error) => sum + error.count, 0);
            const totalWarnings = Object.values(analysisData.warnings).reduce((sum, warning) => sum + warning.count, 0);
            
            updateStats({
                totalLines: analysisData.totalLines,
                totalErrors: totalErrors,
                totalWarnings: totalWarnings,
                uniqueErrors: analysisData.uniqueErrors.size,
                uniqueWarnings: analysisData.uniqueWarnings.size,
                filesAnalyzed: analysisData.files
            });

            populateErrorsList();
            populateWarningsList();
            populateRecurringList();
            populatePatternsList();
            generateTrends();
        }

        function updateStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.totalLines.toLocaleString()}</div>
                    <div class="stat-label">Total Lines</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalErrors}</div>
                    <div class="stat-label">Total Errors</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalWarnings}</div>
                    <div class="stat-label">Total Warnings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.uniqueErrors}</div>
                    <div class="stat-label">Unique Errors</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.filesAnalyzed}</div>
                    <div class="stat-label">Files Analyzed</div>
                </div>
            `;
        }

        function populateErrorsList() {
            const errorsList = document.getElementById('errorsList');
            const sortedErrors = Object.entries(analysisData.errors)
                .sort(([,a], [,b]) => b.count - a.count)
                .slice(0, 10);

            if (sortedErrors.length === 0) {
                errorsList.innerHTML = '<div class="no-data">No critical errors found</div>';
                return;
            }

            errorsList.innerHTML = sortedErrors.map(([message, data]) => `
                <div class="error-item severity-${data.severity}">
                    <div class="item-content">
                        <div class="item-message">${message}</div>
                        <div class="item-details">Files: ${data.files.size} | Lines: ${data.lines.length}</div>
                    </div>
                    <div class="item-count">${data.count}</div>
                </div>
            `).join('');
        }

        function populateWarningsList() {
            const warningsList = document.getElementById('warningsList');
            const sortedWarnings = Object.entries(analysisData.warnings)
                .sort(([,a], [,b]) => b.count - a.count)
                .slice(0, 10);

            if (sortedWarnings.length === 0) {
                warningsList.innerHTML = '<div class="no-data">No warnings found</div>';
                return;
            }

            warningsList.innerHTML = sortedWarnings.map(([message, data]) => `
                <div class="warning-item">
                    <div class="item-content">
                        <div class="item-message">${message}</div>
                        <div class="item-details">Files: ${data.files.size} | Lines: ${data.lines.length}</div>
                    </div>
                    <div class="item-count">${data.count}</div>
                </div>
            `).join('');
        }

        function populateRecurringList() {
            const recurringList = document.getElementById('recurringList');
            const allIssues = [
                ...Object.entries(analysisData.errors).map(([msg, data]) => ({message: msg, count: data.count, type: 'error'})),
                ...Object.entries(analysisData.warnings).map(([msg, data]) => ({message: msg, count: data.count, type: 'warning'}))
            ];
            
            const recurring = allIssues.filter(issue => issue.count >= 3)
                .sort((a, b) => b.count - a.count)
                .slice(0, 10);

            if (recurring.length === 0) {
                recurringList.innerHTML = '<div class="no-data">No recurring issues detected</div>';
                return;
            }

            recurringList.innerHTML = recurring.map(issue => `
                <div class="${issue.type}-item">
                    <div class="item-content">
                        <div class="item-message">${issue.message}</div>
                        <div class="item-details">Recurring ${issue.type}</div>
                    </div>
                    <div class="item-count">${issue.count}</div>
                </div>
            `).join('');
        }

        function populatePatternsList() {
            const patternsList = document.getElementById('patternsList');
            const sortedPatterns = Object.entries(analysisData.patterns)
                .sort(([,a], [,b]) => b.count - a.count)
                .slice(0, 10);

            if (sortedPatterns.length === 0) {
                patternsList.innerHTML = '<div class="no-data">No significant patterns detected</div>';
                return;
            }

            patternsList.innerHTML = sortedPatterns.map(([pattern, data]) => `
                <div class="pattern-item">
                    <div class="item-content">
                        <div class="item-message">${pattern}</div>
                        <div class="item-details">Pattern type: ${data.type}</div>
                    </div>
                    <div class="item-count">${data.count}</div>
                </div>
            `).join('');
        }

        function generateTrends() {
            const trendsContent = document.getElementById('trendsContent');
            const trends = [];

            const totalErrors = Object.values(analysisData.errors).reduce((sum, error) => sum + error.count, 0);
            const errorRate = ((totalErrors / analysisData.totalLines) * 100).toFixed(2);
            
            if (errorRate > 5) {
                trends.push(`‚ö†Ô∏è High error rate detected: ${errorRate}% of log lines contain errors`);
            } else if (errorRate > 1) {
                trends.push(`üìä Moderate error rate: ${errorRate}% of log lines contain errors`);
            } else {
                trends.push(`‚úÖ Low error rate: ${errorRate}% of log lines contain errors`);
            }

            const topError = Object.entries(analysisData.errors)
                .sort(([,a], [,b]) => b.count - a.count)[0];
            
            if (topError) {
                trends.push(`üéØ Most frequent issue: "${topError[0]}" occurred ${topError[1].count} times`);
            }

            const httpErrors = Object.entries(analysisData.patterns)
                .filter(([pattern]) => pattern.startsWith('HTTP 4') || pattern.startsWith('HTTP 5'))
                .reduce((sum, [,data]) => sum + data.count, 0);
            
            if (httpErrors > 0) {
                trends.push(`üåê HTTP issues detected: ${httpErrors} client/server errors found`);
            }

            if (trends.length === 0) {
                trends.push('üìà No significant trends detected in the analyzed logs');
            }

            trendsContent.innerHTML = trends.map(trend => `
                <div class="trend-item">${trend}</div>
            `).join('');
        }

        function showLoading(show) {
            loadingSection.style.display = show ? 'block' : 'none';
        }

        function showResults() {
            resultsSection.style.display = 'block';
        }

        // NEW QUERY FUNCTIONALITY
        queryBtn.addEventListener('click', () => {
            const question = queryInput.value.trim();
            if (question) {
                processQuestion(question);
            }
        });

        function processQuestion(question) {
            const lowerCaseQuestion = question.toLowerCase();
            let answer = '<p class="no-data">Sorry, I could not find a specific answer for that question.</p>';

            if (Object.keys(analysisData).length === 0 || analysisData.totalLines === 0) {
                queryResultsDiv.innerHTML = '<p class="no-data">Please upload and analyze logs first.</p>';
                return;
            }

            // Case 1: Ask for errors
            if (lowerCaseQuestion.includes('errors') || lowerCaseQuestion.includes('exceptions')) {
                let keyword = lowerCaseQuestion.replace(/show me|find|all|of|the|for|errors|exceptions|occurred|in|over|the|last/g, '').trim();
                
                let matchingErrors = Object.entries(analysisData.errors);
                if (keyword) {
                    matchingErrors = matchingErrors.filter(([message]) => message.toLowerCase().includes(keyword));
                }
                
                matchingErrors.sort(([, a], [, b]) => b.count - a.count);

                if (matchingErrors.length > 0) {
                    answer = '<h4>Most frequent errors found:</h4><ul style="list-style: none; padding: 0;">';
                    answer += matchingErrors.slice(0, 5).map(([message, data]) => `
                        <li style="margin-bottom: 10px;">
                            <div class="item-message"><strong>${message}</strong></div>
                            <div class="item-details">Occurrences: ${data.count} | Files: ${data.files.size}</div>
                        </li>
                    `).join('');
                    answer += '</ul>';
                }
            }
            
            // Case 2: Ask for a specific keyword or pattern
            else if (lowerCaseQuestion.includes('show me') || lowerCaseQuestion.includes('find') || lowerCaseQuestion.includes('count')) {
                const keywords = lowerCaseQuestion.replace(/show me|find|count|all|of|the/g, '').trim().split(' ');
                const matchingLines = [];
                
                Object.entries(analysisData.errors).forEach(([message, data]) => {
                    if (keywords.some(keyword => message.toLowerCase().includes(keyword))) {
                        matchingLines.push(`Found ${data.count} occurrences of "${message}"`);
                    }
                });
                Object.entries(analysisData.warnings).forEach(([message, data]) => {
                    if (keywords.some(keyword => message.toLowerCase().includes(keyword))) {
                        matchingLines.push(`Found ${data.count} occurrences of "${message}"`);
                    }
                });
                Object.entries(analysisData.patterns).forEach(([pattern, data]) => {
                    if (keywords.some(keyword => pattern.toLowerCase().includes(keyword))) {
                        matchingLines.push(`Found ${data.count} occurrences of "${pattern}"`);
                    }
                });

                if (matchingLines.length > 0) {
                    answer = '<h4>Here is what I found:</h4><ul style="list-style: none; padding: 0;">';
                    answer += matchingLines.map(line => `<li>${line}</li>`).join('');
                    answer += '</ul>';
                }
            }
            
            // Case 3: Ask for total statistics
            else if (lowerCaseQuestion.includes('total')) {
                const totalErrors = Object.values(analysisData.errors).reduce((sum, error) => sum + error.count, 0);
                const totalWarnings = Object.values(analysisData.warnings).reduce((sum, warning) => sum + warning.count, 0);
                const totalLines = analysisData.totalLines;
                
                if (lowerCaseQuestion.includes('total errors')) {
                    answer = `<p>There are a total of <strong>${totalErrors}</strong> errors across all logs.</p>`;
                } else if (lowerCaseQuestion.includes('total warnings')) {
                    answer = `<p>There are a total of <strong>${totalWarnings}</strong> warnings across all logs.</p>`;
                } else if (lowerCaseQuestion.includes('total lines')) {
                    answer = `<p>There are a total of <strong>${totalLines.toLocaleString()}</strong> lines analyzed.</p>`;
                } else {
                    answer = `<p><strong>Summary:</strong><br>
                        Total Lines: ${totalLines.toLocaleString()}<br>
                        Total Errors: ${totalErrors}<br>
                        Total Warnings: ${totalWarnings}</p>`;
                }
            }
            
            // Case 4: Ask about performance (simplified)
            else if (lowerCaseQuestion.includes('response time') || lowerCaseQuestion.includes('performance')) {
                const totalErrors = Object.values(analysisData.errors).reduce((sum, error) => sum + error.count, 0);
                const errorRate = ((totalErrors / analysisData.totalLines) * 100).toFixed(2);
                if (errorRate > 10) {
                    answer = `<p>The current error rate is ${errorRate}%, which may be a sign of poor performance. I recommend investigating further.</p>`;
                } else {
                    answer = `<p>The error rate is low (${errorRate}%), which is a good sign for system stability.</p>`;
                }
            }

            queryResultsDiv.innerHTML = answer;
        }

        // Export functions
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportJSON() {
            const data = {
                analysis_date: new Date().toISOString(),
                summary: {
                    total_lines: analysisData.totalLines,
                    total_errors: Object.values(analysisData.errors).reduce((sum, error) => sum + error.count, 0),
                    total_warnings: Object.values(analysisData.warnings).reduce((sum, warning) => sum + warning.count, 0),
                    files_analyzed: analysisData.files
                },
                errors: analysisData.errors,
                warnings: analysisData.warnings,
                patterns: analysisData.patterns
            };
            downloadFile(JSON.stringify(data, null, 2), 'log_analysis.json', 'application/json');
        }

        function exportCSV() {
            const rows = [['Type', 'Message', 'Count', 'Files', 'Severity']];
            
            Object.entries(analysisData.errors).forEach(([message, data]) => {
                rows.push(['Error', message, data.count, data.files.size, data.severity]);
            });
            
            Object.entries(analysisData.warnings).forEach(([message, data]) => {
                rows.push(['Warning', message, data.count, data.files.size, 'medium']);
            });
            
            const csv = rows.map(row => row.map(field => `"${field}"`).join(',')).join('\n');
            downloadFile(csv, 'log_analysis.csv', 'text/csv');
        }

        function exportReport() {
            const totalErrors = Object.values(analysisData.errors).reduce((sum, error) => sum + error.count, 0);
            const totalWarnings = Object.values(analysisData.warnings).reduce((sum, warning) => sum + warning.count, 0);
            
            const report = `LOG ANALYSIS REPORT
Generated: ${new Date().toLocaleString()}

SUMMARY
=======
Total Lines Analyzed: ${analysisData.totalLines.toLocaleString()}
Total Errors: ${totalErrors}
Total Warnings: ${totalWarnings}
Unique Error Types: ${analysisData.uniqueErrors.size}
Files Analyzed: ${analysisData.files}

TOP ERRORS
==========
${Object.entries(analysisData.errors)
    .sort(([,a], [,b]) => b.count - a.count)
    .slice(0, 5)
    .map(([message, data], index) => `${index + 1}. ${message} (${data.count} occurrences)`)
    .join('\n')}

TOP WARNINGS
============
${Object.entries(analysisData.warnings)
    .sort(([,a], [,b]) => b.count - a.count)
    .slice(0, 5)
    .map(([message, data], index) => `${index + 1}. ${message} (${data.count} occurrences)`)
    .join('\n')}

RECOMMENDATIONS
===============
${totalErrors > analysisData.totalLines * 0.05 ? '‚Ä¢ High error rate detected - investigate system stability' : ''}
${analysisData.uniqueErrors.size > 10 ? '‚Ä¢ Multiple error types found - review error handling' : ''}
${Object.keys(analysisData.patterns).length > 0 ? '‚Ä¢ Patterns detected - consider implementing monitoring' : ''}
`;
            downloadFile(report, 'log_analysis_report.txt', 'text/plain');
        }

        // Clear function
        clearBtn.addEventListener('click', () => {
            logFiles = [];
            analysisData = {};
            fileInput.value = '';
            analyzeBtn.disabled = true;
            resultsSection.style.display = 'none';
            queryResultsDiv.innerHTML = '<p class="no-data">Your answers will appear here...</p>';
            uploadArea.querySelector('.upload-text').innerHTML = 
                '<strong>Drop your log files here or click to browse</strong><br>Supports .log, .txt, .csv files and more';
        });
    </script>
</body>
</html>